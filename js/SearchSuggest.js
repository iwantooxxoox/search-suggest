'use strict';var _createClass=function(){function c(f,g){for(var j,h=0;h<g.length;h++)j=g[h],j.enumerable=j.enumerable||!1,j.configurable=!0,'value'in j&&(j.writable=!0),Object.defineProperty(f,j.key,j)}return function(f,g,h){return g&&c(f.prototype,g),h&&c(f,h),f}}();function _classCallCheck(c,f){if(!(c instanceof f))throw new TypeError('Cannot call a class as a function')}var SearchSuggest=function(){function c(f){_classCallCheck(this,c),this.props=f,this.id='',this.curIndex=0,this.disableMouseover=!1,this.outterHeight=0,this.itemHeight=0,this.items=[],this.render()}return _createClass(c,[{key:'renderSearchBlock',value:function renderSearchBlock(f,g,h){g.className='search_block',h.className='search_suggest';var j=f.parentNode;j.replaceChild(g,f),g.appendChild(f),g.appendChild(h)}},{key:'setFocusedItemIndex',value:function setFocusedItemIndex(f,g){if(0<=f&&f<this.items.length&&this.curIndex!==f){this.items[f].className=this.id+' item focusedItem',this.items[this.curIndex].className=this.id+' item';var h=this.items[f].offsetTop;h>this.outterHeight+g.scrollTop?g.scrollTop=h-this.outterHeight:h<this.outterHeight+g.scrollTop&&!(h>g.scrollTop+this.itemHeight)&&this.items[f].scrollIntoView(),this.curIndex=f}}},{key:'renderDeleteButton',value:function renderDeleteButton(f,g,h,j,k){var m=this;if(!f.querySelector('.deleteButton')){var l=document.createElement('p');l.className='deleteButton',l.innerHTML='&#10060',l.style.display=g<k?'block':'none',l.onmousedown=function(n){n.stopPropagation();var o=window.confirm('Are you sure you want to remove the item from search history?');o&&('undefined'!==window.localStorage&&window.localStorage.removeItem(f.getElementsByClassName('name')[0].innerText),l.style.display='none',j.removeChild(f),j.appendChild(f),m.items=j.childNodes,m.curIndex=j.childNodes.length-1,m.setFocusedItemIndex(0,j),m.rebindMouseOverEvent(j),m.rebindMousedownEvent(j,h))},f.appendChild(l)}}},{key:'renderItem',value:function renderItem(f,g,h,j,k){var o=this,l=document.createElement('div');l.className=this.id+' item';var m=document.createElement('div');m.className='name',m.innerHTML=f.name;var n=document.createElement('img');return n.className='logo',n.src=f.logo,l.appendChild(n),l.appendChild(m),l.onmousedown=function(p){o.setFocusedItemIndex(h,j),o.setSelectedItem(p,g,j)},l.onmouseover=function(){return o.setFocusedItemIndex(h,j)},l.className=h===this.curIndex?this.id+' item focusedItem':this.id+' item',this.renderDeleteButton(l,h,g,j,k),l}},{key:'rebindMouseOverEvent',value:function rebindMouseOverEvent(f){var g=this;this.items.forEach(function(h,j){h.onmouseover=function(){g.setFocusedItemIndex(j,f)}})}},{key:'rebindMousedownEvent',value:function rebindMousedownEvent(f,g){var h=this;this.items.forEach(function(j,k){j.onmousedown=function(l){h.setFocusedItemIndex(k,f),h.setSelectedItem(l,g,f)}})}},{key:'renderSearchSuggestList',value:function renderSearchSuggestList(f,g,h,j){var m=this,k=Array(f.item.length),l=g.length;f.item.forEach(function(n){var p=g.indexOf(n.name);-1===p?(k[l]=n,++l):k[p]=n}),k.forEach(function(n,o){h.appendChild(m.renderItem(n,j,o,h,g.length))}),h.onmousemove=function(){m.disableMouseover&&(m.disableMouseover=!1,m.rebindMouseOverEvent(h))},this.items=document.querySelectorAll('.'+this.id+'.item'),console.log(this.items)}},{key:'setSelectedItem',value:function setSelectedItem(f,g,h){f.preventDefault();var j=document.querySelector('.'+this.id+'.focusedItem'),k=j.getElementsByClassName('name')[0],l=j.getElementsByClassName('deleteButton')[0];l.style.display='block',g.onblur(),g.value=k.innerText,'undefined'!==window.localStorage&&localStorage.setItem(g.value,Date.now()),h.removeChild(j),h.insertBefore(j,h.firstChild),this.curIndex=0,this.items=document.querySelectorAll('.'+this.id+'.item'),this.rebindMouseOverEvent(h),this.rebindMousedownEvent(h,g)}},{key:'focusPreviousOption',value:function focusPreviousOption(f,g){f.preventDefault(),this.setFocusedItemIndex(this.curIndex-1,g)}},{key:'focusNextOption',value:function focusNextOption(f,g){f.preventDefault(),this.setFocusedItemIndex(this.curIndex+1,g)}},{key:'bindInputFieldEvents',value:function bindInputFieldEvents(f,g){var h=this;f.onfocus=function(){g.style.display='block'},f.onblur=function(){g.style.display='none'},f.onkeydown=function(j){switch(j.keyCode){case 13:h.setSelectedItem(j,f,g);break;case 38:h.focusPreviousOption(j,g);break;case 40:h.focusNextOption(j,g);break;default:f.onfocus();}},f.onkeyup=function(j){var k=f.value.toUpperCase(),l=!1;h.disableMouseover||h.items.forEach(function(m){m.onmouseover=null,h.disableMouseover=!0}),h.items.forEach(function(m,n){var o=m.querySelector('.name').innerText.toUpperCase();-1===o.indexOf(k)?m.style.display='none':(m.style.display='flex',-1===[13,38,40].indexOf(j.keyCode)&&!l&&(l=!0,h.setFocusedItemIndex(n,g)))})}}},{key:'render',value:function render(){var f=this.props.el;this.id=f.getAttribute('id');var g=this.props.data,h=[];'undefined'!==window.localStorage&&(h=Object.keys(localStorage).sort(function(l,m){return localStorage.getItem(m)-localStorage.getItem(l)}));var j=document.createElement('div'),k=document.createElement('div');this.renderSearchBlock(f,j,k),this.renderSearchSuggestList(g,h,k,f),this.outterHeight=parseInt(window.getComputedStyle(k).getPropertyValue('max-height'),10),this.itemHeight=parseInt(window.getComputedStyle(this.items&&this.items[0]).getPropertyValue('height'),10),this.bindInputFieldEvents(f,k)}}]),c}();